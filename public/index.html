<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Simulator Engineering Authoring Tool</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
  <script src="https://cdn.tiny.cloud/1/h9xs5cld1bkmamb6zycl5ymhfanahso689gglclrgt5gldlx/tinymce/7/tinymce.min.js"
    referrerpolicy="origin"></script>
  <!-- ====== CRITICAL: DEFINE FUNCTIONS FIRST ====== -->
  <!-- ====== END CRITICAL SECTION ====== -->
</head>

<body>
  <div class="container mt-5">

    <!-- ====================== CHOICE SCREEN ====================== -->
    <div id="choiceScreen">
      <h1 class="text-center mb-5">Simulator Engineering Authoring Tool</h1>
      <div class="row g-4">
        <div class="col-md-6">
          <div class="card choice-card h-100 text-center p-4" onclick="showCreateForm()">
            <h2 class="text-primary">Create New SEA</h2>
            <p class="text-muted">Start a fresh engineering authorization</p>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card choice-card h-100 text-center p-4" onclick="showSeaList()">
            <h2 class="text-success">View / Edit Existing SEA</h2>
            <p class="text-muted">Search and modify previous submissions</p>
          </div>
        </div>
      </div>

      <!-- ABOUT SECTION – ONLY ON CHOICE SCREEN -->
      <footer id="siteFooter">
        <div class="container">
          <div class="row">
            <div class="col-lg-12 mx-auto text-center">
              <h5>About the Simulator Engineering Authoring Tool (SEAT)</h5>
              <p>
                The <strong>Simulator Engineering Authoring Tool (SEAT)</strong> is a specialized web-based platform
                designed to simplify the creation, management, and documentation of <em>Simulator Engineering
                  Authorizations (SEAs)</em>. Built for engineering teams in aviation and simulation industries, SEAT
                provides an intuitive interface for handling authorization requests related to aircraft simulator
                fleets, such as Boeing 737, 777, 787, and Airbus A320 models.
              </p>
              <p>
                It ensures compliance, traceability, and efficiency by digitizing the entire workflow—from initial
                submission to PDF generation and archival.
              </p>

              <h6>Key Features:</h6>
              <ul class="list-unstyled text-start d-inline-block">
                <li>SEA Creation and Editing</li>
                <li>Parts and Instructions Management</li>
                <li>Attachment Handling</li>
                <li>PDF Generation with embedded attachments</li>
                <li>SEA Dashboard with search and actions</li>
                <li>Fleet-Specific Device Selection</li>
                <li>User-Friendly Responsive Interface</li>
              </ul>

              <p class="mt-3">
                SEAT addresses the challenges of manual engineering authorization processes by providing a centralized,
                digital solution that reduces errors, speeds up approvals, and maintains an audit trail. It's ideal for
                simulator maintenance teams, engineers, and requesters who need to document changes, justify
                modifications, and assess impacts on critical training equipment.
              </p>

              <p class="text-muted small">
                <em>Developed with PHP, mPDF, Bootstrap, and modern web technologies. Extensible and deployable on
                  standard web servers.</em><br>
              <p class="text-muted small" id="versionInfo">
                <em>Loading version...</em>
              </p>

              <script>
                fetch('version.json')
                  .then(r => r.ok ? r.json() : { tag: 'dev', commit: '??', date: 'unknown' })
                  .then(v => {
                    const el = document.getElementById('versionInfo');
                    el.innerHTML = `
        <strong>Version:</strong> 
        <a href="https://github.com/yourname/your-repo/commit/${v.commit}" target="_blank" class="text-decoration-none">
          ${v.tag}
        </a>
        <code class="text-muted">(${v.commit})</code>
        | <strong>Last Updated:</strong> ${v.date}
      `;
                  })
                  .catch(() => {
                    document.getElementById('versionInfo').innerHTML = '<em>Version info unavailable</em>';
                  });
              </script>
            </div>
          </div>
        </div>
      </footer>
    </div>

    <!-- ====================== CREATE / EDIT FORM ====================== -->
    <div id="createForm" class="hidden">
      <!-- <h2 id="formTitle" class="mb-4">New SEA</h2> -->
      <button class="btn btn-sm btn-outline-secondary mb-3" onclick="goBack()">Back</button>
      <h2 id="formTitle" class="mb-3 d-flex justify-content-between align-items-center">
        <span>New SEA</span>
        <div>
          <button type="button" class="btn btn-sm btn-outline-secondary me-2" onclick="showSeaList()">Cancel</button>
          <button type="button" class="btn btn-sm btn-secondary" onclick="goBack()">Back</button>
        </div>
      </h2>

      <form id="seaForm" enctype="multipart/form-data">
        <input type="hidden" id="sea_action" name="action" value="create">
        <input type="hidden" id="sea_id" name="sea_id" value="">

        <div class="row g-3 mb-3">
          <!-- SEA ID (display only) -->
          <div class="col-md-4">
            <label for="display_id" class="form-label">SEA ID</label>
            <input type="text" class="form-control bg-light" id="display_id" readonly placeholder="Auto-generated">
          </div>
          <!-- EA# & Revision -->
          <div class="col-md-4">
            <label for="ea_number" class="form-label">EA#</label>
            <input type="text" class="form-control" id="ea_number" name="ea_number" placeholder="e.g. EA-12345">
          </div>
          <div class="col-md-4">
            <label for="revision" class="form-label">EA Revision</label>
            <input type="text" class="form-control" id="revision" name="revision" placeholder="e.g. A">
          </div>

          <div class="row g-3 mb-4">
            <div class="col-md-4">
              <label class="form-label">Priority</label>
              <select class="form-select" id="priority" name="priority">
                <option value="Low">Low</option>
                <option value="Medium" selected>Medium</option>
                <option value="High">High</option>
                <option value="Critical">Critical</option>
              </select>
            </div>
            <div class="col-md-4">
              <label class="form-label">Target Date</label>
              <input type="date" class="form-control" id="target_date" name="target_date">
            </div>
            <div class="col-md-4">
              <label for="status" class="form-label">Status</label>
              <select class="form-select" id="status" name="status">
                <option value="Planning" selected>Planning</option>
                <option value="In Work">In Work</option>
                <option value="Completed">Completed</option>
                <option value="On Hold">On Hold</option>
              </select>
            </div>
          </div>
          <!-- Status -->


          <!-- Fleet -->
          <div class="col-md-6">
            <label for="fleet" class="form-label">Fleet<span class="text-danger">*</span></label>
            <select class="form-select select2" id="fleet" name="fleet" required>
              <option value="">-- Select Fleet --</option>
              <option value="737">737</option>
              <option value="777">777</option>
              <option value="787">787</option>
              <option value="A320">A320</option>
              <!-- add more fleets here -->
            </select>
          </div>

          <!-- Device (multi-select) -->
          <div class="col-md-6">
            <label for="device" class="form-label">Device(s)</label>
            <select class="form-select select2" id="device" name="device[]" multiple></select>
          </div>

          <!-- Requester -->
          <div class="col-md-12">
            <label for="requester" class="form-label">Author<span class="text-danger">*</span></label>
            <input type="text" class="form-control" id="requester" name="requester" required>
          </div>

          <!-- Description -->
          <div class="col-md-12">
            <label for="description" class="form-label">Description<span class="text-danger">*</span></label>
            <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
          </div>

          <!-- Justification -->
          <div class="col-md-12">
            <label for="justification" class="form-label">Justification</label>
            <textarea class="form-control" id="justification" name="justification" rows="2"></textarea>
          </div>

          <!-- Impact -->
          <div class="col-md-12">
            <label for="impact" class="form-label">Impact On Training Device</label>
            <textarea class="form-control" id="impact" name="impact" rows="5"></textarea>
          </div>

          <!-- ==================== PARTS TABLE ==================== -->
          <h4 class="mt-4">Affected Parts</h4>
          <table class="table table-sm parts-table" id="partsTable">
            <thead>
              <tr>
                <th>Part #</th>
                <th>Description</th>
                <th>Type</th>
                <th>Qty</th>
                <th style="width:50px;"></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <button type="button" class="btn btn-outline-secondary btn-sm mb-3" onclick="addPartRow()">+ Add Part</button>

          <!-- ==================== INSTRUCTIONS TABLE ==================== -->
          <h4 class="mt-4">Work Instructions</h4>
          <table class="table table-sm instr-table" id="instrTable">
            <thead>
              <tr>
                <th style="width:5%;">#</th>
                <th style="width:70%;">Instruction</th>
                <th style="width:20%;">Notes</th>
                <th style="width:5%;"></th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <button type="button" class="btn btn-outline-secondary btn-sm mb-3" onclick="addInstrRow()">+ Add
            Instruction</button>

          <!-- Attachments -->
          <div class="col-md-12">
            <label for="attachments" class="form-label">Attachments</label>
            <input type="file" class="form-control" id="attachments" name="attachments[]" multiple>
            <div id="existingAttachments" class="mt-2"></div>
          </div>
        </div>

        <!-- ==================== SUBMIT ==================== -->
        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
          <button type="button" class="btn btn-secondary me-md-2" onclick="goBack()">Back</button>
          <button type="submit" id="submitBtn" class="btn btn-primary">Create SEA</button>
        </div>
      </form>
    </div>
    <!-- ====================== LIST VIEW ====================== -->
    <div id="listView" class="hidden">
      <button class="btn btn-sm btn-outline-secondary mb-3" onclick="goBack()">Back</button>
      <h3>Existing SEAs</h3>
      <div class="row mb-3">
        <div class="col-md-6">
          <input type="text" id="searchInput" class="form-control" placeholder="Search by keyword...">
        </div>
        <div class="col-md-6">
          <select id="fleetFilter" class="form-select">
            <option value="">All Fleets</option>
            <!-- Options will be populated dynamically -->
          </select>
        </div>
      </div>
      <div id="seaContainer" class="row"></div> <!-- Content from list_seas.php loads here -->
    </div>


    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="js/app.js"></script>


    <!-- Overwrite Confirmation Modal -->
    <div class="modal fade" id="overwriteModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title text-warning">File Already Exists</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <p>The following file(s) already exist:</p>
            <ul id="conflictList" class="list-unstyled"></ul>
            <p>Do you want to <strong>overwrite</strong> them?</p>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-warning" id="confirmOverwrite">Overwrite</button>
          </div>
        </div>
      </div>
    </div>

</body>

</html>